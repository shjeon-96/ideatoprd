---
phase: 03-authentication
plan: 01
type: execute
depends_on: []
files_modified:
  - src/shared/lib/supabase/client.ts
  - src/shared/lib/supabase/server.ts
  - src/shared/lib/supabase/middleware.ts
  - src/shared/lib/supabase/index.ts
  - src/shared/types/auth.ts
  - .env.example
  - .env.local
---

<objective>
Supabase 클라이언트 설정 및 인증 유틸리티 구축

Purpose: Next.js App Router에서 Supabase Auth를 사용하기 위한 기반 설정
Output: 브라우저/서버/미들웨어용 Supabase 클라이언트, 타입 정의
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-foundation/02-01-SUMMARY.md

**Tech stack available:**
- Next.js 16.1.1 (App Router)
- TypeScript strict mode
- FSD architecture (src/shared/lib/)
- Tailwind CSS v4

**Constraining decisions:**
- Phase 1: FSD 구조 확정 (src/shared/lib/ 사용)
- Phase 2: oklch 색상 체계 (Tailwind v4)

**Discovery findings:**
- `@supabase/ssr` 패키지 사용 (Next.js App Router 지원)
- `createBrowserClient` for client components
- `createServerClient` for server components, route handlers, middleware
- Cookie handling via getAll/setAll pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Supabase packages</name>
  <files>package.json</files>
  <action>
    Install required packages:
    - `@supabase/supabase-js` - Core Supabase client
    - `@supabase/ssr` - SSR utilities for Next.js

    Run: npm install @supabase/supabase-js @supabase/ssr
  </action>
  <verify>npm ls @supabase/supabase-js @supabase/ssr shows both packages installed</verify>
  <done>Both packages in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client utilities</name>
  <files>
    src/shared/lib/supabase/client.ts,
    src/shared/lib/supabase/server.ts,
    src/shared/lib/supabase/middleware.ts,
    src/shared/lib/supabase/index.ts
  </files>
  <action>
    Create three Supabase client factories following @supabase/ssr patterns:

    1. client.ts - Browser client (singleton pattern)
       - Use createBrowserClient from @supabase/ssr
       - Export createClient() function
       - Used in 'use client' components

    2. server.ts - Server client (per-request)
       - Use createServerClient from @supabase/ssr
       - Accept cookies() from next/headers
       - Handle getAll/setAll cookie pattern
       - Used in Server Components and Route Handlers

    3. middleware.ts - Middleware client
       - Use createServerClient from @supabase/ssr
       - Accept NextRequest, return modified response
       - Handle session refresh automatically
       - Export updateSession() helper

    4. index.ts - Re-export all utilities

    Environment variables:
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY

    IMPORTANT: Do NOT create actual middleware.ts at root yet - that's Plan 02
  </action>
  <verify>
    TypeScript compilation passes: npm run build (or tsc --noEmit)
    All files exist with correct exports
  </verify>
  <done>
    - src/shared/lib/supabase/client.ts exports createClient
    - src/shared/lib/supabase/server.ts exports createClient
    - src/shared/lib/supabase/middleware.ts exports updateSession
    - src/shared/lib/supabase/index.ts re-exports all
  </done>
</task>

<task type="auto">
  <name>Task 3: Create auth types and update environment template</name>
  <files>
    src/shared/types/auth.ts,
    src/shared/types/index.ts,
    .env.example
  </files>
  <action>
    1. Create auth types (src/shared/types/auth.ts):
       - User type (id, email, created_at, etc.)
       - Session type
       - AuthError type
       - Re-export Supabase User and Session types for convenience

    2. Create types index (src/shared/types/index.ts):
       - Re-export from auth.ts

    3. Update .env.example with Supabase auth variables:
       - NEXT_PUBLIC_SUPABASE_URL=your-project-url
       - NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
       - (Keep existing variables, add new ones)

    NOTE: Do NOT commit actual credentials. .env.local is gitignored.
  </action>
  <verify>
    - Types compile without errors
    - .env.example contains all Supabase variables with placeholders
  </verify>
  <done>
    - Auth types defined and exported
    - .env.example updated with Supabase variables
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] @supabase/supabase-js and @supabase/ssr in package.json
- [ ] All Supabase client files exist in src/shared/lib/supabase/
- [ ] Auth types defined in src/shared/types/
- [ ] .env.example has NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Supabase client utilities ready for use in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentication/03-01-SUMMARY.md`
</output>
