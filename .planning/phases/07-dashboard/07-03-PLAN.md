---
phase: 07-dashboard
plan: 03
type: execute
depends_on: ["07-02"]
files_modified:
  - src/features/prd/ui/prd-document.tsx
  - src/features/prd/ui/prd-pdf-download.tsx
  - app/(protected)/dashboard/settings/page.tsx
  - app/(protected)/dashboard/prds/[id]/page.tsx
ai_context: |
  Phase 7 세 번째 플랜: PDF 다운로드 및 설정 페이지.
  @react-pdf/renderer는 반드시 dynamic import + ssr: false.
  07-RESEARCH.md의 PDF 관련 pitfalls 참고.
---

# 07-03: PDF Download + Settings Page

## Overview

PDF 다운로드 기능과 설정 페이지를 구현합니다. @react-pdf/renderer를 dynamic import로 클라이언트에서만 로드하고, 설정 페이지에서 사용자 프로필 정보를 표시합니다.

## Prerequisites

- Plan 07-02 완료 (PRD Detail View)
- prds 테이블의 JSONB content 구조

<objective>
PDF 다운로드 기능 및 설정 페이지 구현

Purpose: PRD를 PDF로 다운로드하고 사용자 프로필을 관리할 수 있도록
Output: PDF 다운로드 버튼, 설정 페이지
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-dashboard/07-RESEARCH.md
@.planning/phases/07-dashboard/07-02-SUMMARY.md

@src/features/prd/index.ts
@app/(protected)/dashboard/prds/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: @react-pdf/renderer 설치 및 PrdDocument 컴포넌트 생성</name>
  <files>src/features/prd/ui/prd-document.tsx</files>
  <action>
    1. 패키지 설치:
       ```bash
       npm install @react-pdf/renderer
       ```

    2. `src/features/prd/ui/prd-document.tsx` 생성:
       - React PDF 컴포넌트 (Document, Page, Text, View, StyleSheet)
       - 'use client' 지시어 불필요 (dynamic import에서 처리)
       - styles: page padding 40, 폰트 크기, 라인 높이 정의
       - Props: prd (title, content)
       - content.markdown에서 기본 텍스트 추출 (Markdown 태그 제거)

    3. 간단한 구조:
       - 페이지 A4 사이즈
       - 제목: fontSize 24, marginBottom 20
       - 콘텐츠: fontSize 12, lineHeight 1.6
       - Markdown 태그 제거: replace(/#|\\*|\\[.*?\\]\\(.*?\\)|`/g, '')

    AVOID: 서버 컴포넌트에서 import하지 않도록 (빌드 오류 발생)
    AVOID: 복잡한 Markdown 파싱 시도하지 않도록 (MVP에서는 텍스트만)
  </action>
  <verify>npm run build 성공, @react-pdf/renderer 설치됨</verify>
  <done>PrdDocument 컴포넌트 생성, A4 PDF 문서 구조</done>
</task>

<task type="auto">
  <name>Task 2: PDF 다운로드 버튼 컴포넌트 생성</name>
  <files>src/features/prd/ui/prd-pdf-download.tsx</files>
  <action>
    1. `src/features/prd/ui/prd-pdf-download.tsx` 생성:
       - 'use client' 지시어
       - dynamic import: next/dynamic로 PDFDownloadLink 로드 (ssr: false)
       - dynamic import: PrdDocument도 동적 로드
       - useState(false) + useEffect로 isClient 상태 관리

    2. 구조:
       - isClient가 false일 때: "Preparing PDF..." 비활성 버튼
       - isClient가 true일 때: PDFDownloadLink 렌더링
       - fileName: title에서 공백을 하이픈으로 변환 + .pdf

    3. PDFDownloadLink 사용:
       ```tsx
       const PDFDownloadLink = dynamic(
         () => import('@react-pdf/renderer').then(mod => mod.PDFDownloadLink),
         { ssr: false, loading: () => <span>Loading...</span> }
       )
       ```

    4. Button: variant="secondary", Download 아이콘 (lucide-react)

    AVOID: ssr: false 없이 import하지 않도록 (빌드 에러)
    AVOID: useEffect 없이 브라우저 API 사용하지 않도록
  </action>
  <verify>npm run build 성공</verify>
  <done>PrdPdfDownload 컴포넌트 생성, dynamic import 패턴 적용</done>
</task>

<task type="auto">
  <name>Task 3: PRD 상세 페이지에 PDF 다운로드 버튼 추가</name>
  <files>app/(protected)/dashboard/prds/[id]/page.tsx, src/features/prd/index.ts</files>
  <action>
    1. PRD 상세 페이지 수정:
       - 액션 버튼 그룹에 PrdPdfDownload 추가
       - CopyMarkdownButton 옆에 배치
       - prd 객체를 props로 전달 (id, title, content)

    2. `src/features/prd/index.ts` 업데이트:
       - PrdDocument, PrdPdfDownload export 추가

    AVOID: Server Component에서 직접 @react-pdf/renderer import하지 않도록
  </action>
  <verify>npm run dev 후 PRD 상세 페이지에서 PDF 다운로드 버튼 확인</verify>
  <done>PDF 다운로드 버튼 통합 완료</done>
</task>

<task type="auto">
  <name>Task 4: 설정 페이지 생성</name>
  <files>app/(protected)/dashboard/settings/page.tsx</files>
  <action>
    1. `app/(protected)/dashboard/settings/page.tsx` 생성:
       - Server Component
       - createClient로 현재 사용자 정보 조회
       - profiles 테이블에서 display_name, avatar_url, credits 조회

    2. 페이지 구조:
       - 페이지 제목: "Settings"
       - Card 컴포넌트로 섹션 구분
       - 프로필 섹션:
         - Avatar (이미지 또는 이니셜)
         - 이메일 (읽기 전용)
         - 표시 이름
       - 크레딧 섹션:
         - 현재 보유 크레딧
         - /purchase 링크 버튼

    3. 메타데이터: title="Settings | IdeaToPRD"

    AVOID: 프로필 수정 기능은 MVP 범위 외 (표시만)
  </action>
  <verify>npm run dev 후 /dashboard/settings 접속 확인</verify>
  <done>설정 페이지 생성, 프로필 정보 표시</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>대시보드 전체 UI - 사이드바, PRD 목록, 상세 뷰, PDF 다운로드, 설정 페이지</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/dashboard
    3. 사이드바 확인:
       - 4개 메뉴 (Dashboard, My PRDs, Credits, Settings)
       - 현재 페이지 활성 상태 표시
    4. PRD 목록 확인:
       - PRD가 있으면 카드 그리드 표시
       - 없으면 "No PRDs yet" + 생성 링크
    5. PRD 상세 확인:
       - Markdown 렌더링 (코드 하이라이팅, 테이블)
       - Copy Markdown 버튼 동작
       - Download PDF 버튼 동작
    6. 설정 페이지 확인:
       - 프로필 정보 표시
       - 크레딧 정보 표시
    7. 반응형 확인:
       - 모바일 뷰에서 사이드바 숨김
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] PDF 다운로드 버튼 클릭 시 PDF 파일 다운로드
- [ ] 설정 페이지에서 프로필 정보 표시
- [ ] 반응형 레이아웃 동작
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Phase 7 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboard/07-03-SUMMARY.md`:

# Phase 7 Plan 3: PDF Download + Settings Summary

**Phase 07-dashboard complete**

## Accomplishments
- PDF 다운로드 기능 (@react-pdf/renderer)
- 설정 페이지 (프로필 정보)
- 대시보드 전체 UI 완성

## Files Created/Modified
- src/features/prd/ui/prd-document.tsx
- src/features/prd/ui/prd-pdf-download.tsx
- app/(protected)/dashboard/settings/page.tsx

## Phase 7 Complete
MVP Dashboard 구현 완료:
- 대시보드 레이아웃 (사이드바)
- PRD 목록 및 상세 뷰
- Markdown 렌더링 + 복사
- PDF 다운로드
- 설정 페이지

Ready for: MVP v1.0 완성
</output>
