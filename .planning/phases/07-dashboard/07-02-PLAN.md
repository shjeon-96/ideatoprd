---
phase: 07-dashboard
plan: 02
type: execute
depends_on: ["07-01"]
files_modified:
  - src/features/prd/api/get-prd.ts
  - src/features/prd/ui/prd-viewer.tsx
  - src/features/prd/ui/copy-markdown-button.tsx
  - src/shared/hooks/use-copy-to-clipboard.ts
  - app/(protected)/dashboard/prds/[id]/page.tsx
ai_context: |
  Phase 7 두 번째 플랜: PRD 상세 뷰와 Markdown 렌더링.
  react-markdown + remark-gfm으로 GFM 지원.
  07-RESEARCH.md의 코드 예시 참고.
---

# 07-02: PRD Detail View + Markdown Rendering

## Overview

PRD 상세 페이지와 Markdown 렌더링 기능을 구현합니다. react-markdown으로 GFM 테이블, 코드 블록을 지원하고, 클립보드 복사 기능을 추가합니다.

## Prerequisites

- Plan 07-01 완료 (Dashboard Layout + PRD List)
- prds 테이블의 JSONB content 구조

<objective>
PRD 상세 뷰 및 Markdown 렌더링 구현

Purpose: 사용자가 생성한 PRD를 보기 좋게 렌더링하고 복사할 수 있도록
Output: PRD 상세 페이지, Markdown 뷰어, 복사 버튼
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-dashboard/07-RESEARCH.md
@.planning/phases/07-dashboard/07-01-SUMMARY.md

@src/entities/index.ts
@src/features/prd/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Markdown 패키지 설치 및 PrdViewer 컴포넌트 생성</name>
  <files>src/features/prd/ui/prd-viewer.tsx</files>
  <action>
    1. 패키지 설치:
       ```bash
       npm install react-markdown remark-gfm react-syntax-highlighter
       npm install -D @types/react-syntax-highlighter
       ```

    2. `src/features/prd/ui/prd-viewer.tsx` 생성:
       - 'use client' 지시어 (클라이언트 컴포넌트)
       - react-markdown + remarkGfm 플러그인
       - components 커스터마이징:
         - code: react-syntax-highlighter (Prism + oneDark 테마)
         - table: overflow-x-auto 감싸기
       - prose 클래스: prose prose-neutral dark:prose-invert max-w-none

    3. Props: content (string - Markdown 텍스트)

    AVOID: HTML sanitization 우회하지 않도록 (react-markdown 기본 설정 유지)
    AVOID: 서버 컴포넌트로 만들지 않도록 (syntax highlighter가 클라이언트 전용)
  </action>
  <verify>npm run build 성공, react-markdown, remark-gfm, react-syntax-highlighter 설치됨</verify>
  <done>PrdViewer 컴포넌트 생성, GFM + 코드 하이라이팅 지원</done>
</task>

<task type="auto">
  <name>Task 2: 클립보드 훅 및 복사 버튼 컴포넌트 생성</name>
  <files>src/shared/hooks/use-copy-to-clipboard.ts, src/features/prd/ui/copy-markdown-button.tsx</files>
  <action>
    1. `src/shared/hooks/use-copy-to-clipboard.ts` 생성:
       - 'use client' 지시어
       - navigator.clipboard.writeText 사용
       - try-catch로 에러 처리 (구형 브라우저, 권한 거부)
       - 반환: { copiedText, copy, reset }

    2. `src/features/prd/ui/copy-markdown-button.tsx` 생성:
       - 'use client' 지시어
       - useCopyToClipboard 훅 사용
       - 복사 후 2초간 "Copied!" 표시
       - lucide-react: Copy, Check 아이콘
       - Button variant="outline" size="sm"

    AVOID: document.execCommand('copy') 사용하지 않도록 (deprecated)
  </action>
  <verify>npm run build 성공, 훅 파일 존재</verify>
  <done>useCopyToClipboard 훅 생성, CopyMarkdownButton 컴포넌트 생성</done>
</task>

<task type="auto">
  <name>Task 3: PRD 단건 조회 API 함수 생성</name>
  <files>src/features/prd/api/get-prd.ts</files>
  <action>
    1. `src/features/prd/api/get-prd.ts` 생성:
       - createClient (서버)로 Supabase 클라이언트 생성
       - prds 테이블에서 id로 단건 조회
       - select: id, title, idea, template, version, content, created_at, updated_at
       - RLS가 자동으로 소유권 확인 (user_id = auth.uid())
       - 없으면 null 반환

    2. content 필드는 JSONB로 저장된 PRD 콘텐츠
       - content.markdown 필드에 전체 Markdown 텍스트 저장됨
       - 타입: { markdown?: string; ... }

    AVOID: 소유하지 않은 PRD 접근 시도 시 에러 발생하지 않도록 (null 반환)
  </action>
  <verify>npm run build 성공</verify>
  <done>getPrd 함수 생성, 단건 조회 기능</done>
</task>

<task type="auto">
  <name>Task 4: PRD 상세 페이지 생성</name>
  <files>app/(protected)/dashboard/prds/[id]/page.tsx, src/features/prd/index.ts</files>
  <action>
    1. `app/(protected)/dashboard/prds/[id]/page.tsx` 생성:
       - Server Component
       - params에서 id 추출
       - getPrd(id)로 PRD 조회
       - 없으면 notFound() 호출

    2. 페이지 구조:
       - 상단: 제목, template 배지, 날짜
       - 액션 버튼 그룹: CopyMarkdownButton
       - Markdown 콘텐츠: PrdViewer 컴포넌트

    3. content.markdown에서 Markdown 텍스트 추출

    4. `src/features/prd/index.ts` 업데이트:
       - getPrd, getPrds, PrdList, PrdViewer, CopyMarkdownButton export

    AVOID: 클라이언트에서 직접 Supabase 쿼리하지 않도록
  </action>
  <verify>npm run dev 후 /dashboard/prds/[valid-id] 접속 확인</verify>
  <done>PRD 상세 페이지 완성, Markdown 렌더링 + 복사 버튼 동작</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] PRD 상세 페이지에서 Markdown 렌더링
- [ ] 코드 블록 syntax highlighting 동작
- [ ] 테이블이 반응형으로 스크롤
- [ ] 복사 버튼 클릭 시 클립보드에 복사 + 피드백
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- PRD 상세 뷰 + Markdown + 복사 기능 동작
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboard/07-02-SUMMARY.md`
</output>
