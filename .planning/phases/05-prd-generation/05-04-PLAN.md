---
phase: 05-prd-generation
plan: 04
type: execute
depends_on: ["05-03"]
files_modified:
  - src/features/prd-generation/ui/prd-form.tsx
  - src/features/prd-generation/ui/prd-viewer.tsx
  - src/features/prd-generation/ui/template-selector.tsx
  - src/features/prd-generation/ui/index.ts
  - src/features/prd-generation/index.ts
  - src/app/(protected)/generate/page.tsx
---

<objective>
PRD 생성 UI 컴포넌트 구현 (폼 + 스트리밍 뷰어)

Purpose: 사용자가 아이디어를 입력하고 실시간으로 PRD 생성 결과를 확인할 수 있는 UI 구축
Output: PRD 생성 폼, 템플릿 선택기, 스트리밍 뷰어 컴포넌트 + /generate 페이지
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-prd-generation/05-RESEARCH.md
@.planning/phases/05-prd-generation/05-03-SUMMARY.md

# API 엔드포인트
@src/app/api/generate-prd/route.ts

# 타입 및 상수
@src/features/prd-generation/model/types.ts

# 기존 UI 패턴
@src/features/auth/ui/login-form.tsx
@src/shared/ui/button.tsx

# DB enum 타입
@src/entities/index.ts

**Established patterns:**
- 'use client' for interactive components
- shadcn/ui Button, Card, Input 컴포넌트 활용
- lucide-react 아이콘
- Tailwind CSS v4 + oklch 색상
</context>

<tasks>

<task type="auto">
  <name>Task 1: 템플릿 선택기 및 PRD 폼 컴포넌트</name>
  <files>src/features/prd-generation/ui/template-selector.tsx, src/features/prd-generation/ui/prd-form.tsx</files>
  <action>
    1. src/features/prd-generation/ui/template-selector.tsx:
    ```typescript
    'use client';

    import type { PRDTemplate } from '@/src/entities';
    import { cn } from '@/src/shared/lib/utils';
    import { Briefcase, Smartphone, Store, Puzzle, Sparkles } from 'lucide-react';

    interface TemplateSelectorProps {
      value: PRDTemplate;
      onChange: (template: PRDTemplate) => void;
      disabled?: boolean;
    }

    const TEMPLATES: { id: PRDTemplate; label: string; icon: typeof Briefcase; description: string }[] = [
      { id: 'saas', label: 'SaaS', icon: Briefcase, description: '구독 기반 웹 서비스' },
      { id: 'mobile', label: 'Mobile', icon: Smartphone, description: 'iOS/Android 앱' },
      { id: 'marketplace', label: 'Marketplace', icon: Store, description: '양면 플랫폼' },
      { id: 'extension', label: 'Extension', icon: Puzzle, description: '브라우저/앱 확장' },
      { id: 'ai-wrapper', label: 'AI Wrapper', icon: Sparkles, description: 'AI 기반 서비스' },
    ];

    export function TemplateSelector({ value, onChange, disabled }: TemplateSelectorProps) {
      return (
        <div className="grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5">
          {TEMPLATES.map(({ id, label, icon: Icon, description }) => (
            <button
              key={id}
              type="button"
              onClick={() => onChange(id)}
              disabled={disabled}
              className={cn(
                'flex flex-col items-center gap-2 rounded-xl border-2 p-4 transition-all',
                'hover:border-primary/50 hover:bg-primary/5',
                'disabled:cursor-not-allowed disabled:opacity-50',
                value === id
                  ? 'border-primary bg-primary/10 text-primary'
                  : 'border-border bg-card text-muted-foreground'
              )}
            >
              <Icon className="h-6 w-6" />
              <span className="font-medium text-sm">{label}</span>
              <span className="text-xs text-center opacity-70">{description}</span>
            </button>
          ))}
        </div>
      );
    }
    ```

    2. src/features/prd-generation/ui/prd-form.tsx:
    ```typescript
    'use client';

    import { useState } from 'react';
    import { Button } from '@/src/shared/ui/button';
    import { TemplateSelector } from './template-selector';
    import { MAX_IDEA_LENGTH, MIN_IDEA_LENGTH } from '../model/types';
    import type { PRDTemplate, PRDVersion } from '@/src/entities';
    import { Loader2, FileText, Zap } from 'lucide-react';

    interface PRDFormProps {
      onSubmit: (data: { idea: string; template: PRDTemplate; version: PRDVersion }) => void;
      isLoading: boolean;
      userCredits: number;
    }

    export function PRDForm({ onSubmit, isLoading, userCredits }: PRDFormProps) {
      const [idea, setIdea] = useState('');
      const [template, setTemplate] = useState<PRDTemplate>('saas');
      const [version, setVersion] = useState<PRDVersion>('basic');

      const creditsRequired = version === 'detailed' ? 2 : 1;
      const hasEnoughCredits = userCredits >= creditsRequired;
      const isValidIdea = idea.trim().length >= MIN_IDEA_LENGTH;

      const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        if (!isValidIdea || !hasEnoughCredits || isLoading) return;
        onSubmit({ idea: idea.trim(), template, version });
      };

      return (
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Idea Input */}
          <div className="space-y-2">
            <label htmlFor="idea" className="text-sm font-medium">
              아이디어 <span className="text-muted-foreground">({idea.length}/{MAX_IDEA_LENGTH})</span>
            </label>
            <textarea
              id="idea"
              value={idea}
              onChange={(e) => setIdea(e.target.value.slice(0, MAX_IDEA_LENGTH))}
              placeholder="예: AI 기반 이력서 분석 서비스로 구직자의 이력서를 분석하고 개선점을 제안합니다."
              rows={3}
              disabled={isLoading}
              className="w-full rounded-lg border border-input bg-background px-4 py-3 text-base placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50"
            />
            {idea.length > 0 && idea.length < MIN_IDEA_LENGTH && (
              <p className="text-sm text-destructive">최소 {MIN_IDEA_LENGTH}자 이상 입력해주세요.</p>
            )}
          </div>

          {/* Template Selector */}
          <div className="space-y-2">
            <label className="text-sm font-medium">템플릿 선택</label>
            <TemplateSelector value={template} onChange={setTemplate} disabled={isLoading} />
          </div>

          {/* Version Selector */}
          <div className="space-y-2">
            <label className="text-sm font-medium">PRD 버전</label>
            <div className="flex gap-3">
              <button
                type="button"
                onClick={() => setVersion('basic')}
                disabled={isLoading}
                className={`flex-1 rounded-lg border-2 p-4 transition-all ${
                  version === 'basic'
                    ? 'border-primary bg-primary/10'
                    : 'border-border hover:border-primary/50'
                }`}
              >
                <div className="flex items-center gap-2">
                  <FileText className="h-5 w-5" />
                  <span className="font-medium">기본</span>
                  <span className="ml-auto text-sm text-muted-foreground">1 크레딧</span>
                </div>
                <p className="mt-1 text-left text-sm text-muted-foreground">핵심 섹션만 포함</p>
              </button>
              <button
                type="button"
                onClick={() => setVersion('detailed')}
                disabled={isLoading}
                className={`flex-1 rounded-lg border-2 p-4 transition-all ${
                  version === 'detailed'
                    ? 'border-primary bg-primary/10'
                    : 'border-border hover:border-primary/50'
                }`}
              >
                <div className="flex items-center gap-2">
                  <Zap className="h-5 w-5" />
                  <span className="font-medium">상세</span>
                  <span className="ml-auto text-sm text-muted-foreground">2 크레딧</span>
                </div>
                <p className="mt-1 text-left text-sm text-muted-foreground">모든 섹션 상세 작성</p>
              </button>
            </div>
          </div>

          {/* Credit Warning */}
          {!hasEnoughCredits && (
            <div className="rounded-lg bg-destructive/10 p-4 text-destructive">
              크레딧이 부족합니다. (보유: {userCredits}, 필요: {creditsRequired})
            </div>
          )}

          {/* Submit Button */}
          <Button
            type="submit"
            size="lg"
            className="w-full"
            disabled={!isValidIdea || !hasEnoughCredits || isLoading}
          >
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                PRD 생성 중...
              </>
            ) : (
              <>PRD 생성하기 ({creditsRequired} 크레딧)</>
            )}
          </Button>
        </form>
      );
    }
    ```

    주의:
    - 입력 길이 실시간 표시
    - 크레딧 부족 시 경고
    - 로딩 상태 비활성화
  </action>
  <verify>TypeScript 컴파일 성공</verify>
  <done>TemplateSelector, PRDForm 컴포넌트 완성</done>
</task>

<task type="auto">
  <name>Task 2: PRD 스트리밍 뷰어 컴포넌트</name>
  <files>src/features/prd-generation/ui/prd-viewer.tsx, src/features/prd-generation/ui/index.ts</files>
  <action>
    1. src/features/prd-generation/ui/prd-viewer.tsx:
    ```typescript
    'use client';

    import { useEffect, useRef } from 'react';
    import { Copy, Check, Download } from 'lucide-react';
    import { useState } from 'react';
    import { Button } from '@/src/shared/ui/button';

    interface PRDViewerProps {
      content: string;
      isStreaming: boolean;
    }

    export function PRDViewer({ content, isStreaming }: PRDViewerProps) {
      const containerRef = useRef<HTMLDivElement>(null);
      const [copied, setCopied] = useState(false);

      // Auto-scroll while streaming
      useEffect(() => {
        if (isStreaming && containerRef.current) {
          containerRef.current.scrollTop = containerRef.current.scrollHeight;
        }
      }, [content, isStreaming]);

      const handleCopy = async () => {
        await navigator.clipboard.writeText(content);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      if (!content) {
        return (
          <div className="flex h-[400px] items-center justify-center rounded-lg border border-dashed border-border bg-muted/50">
            <p className="text-muted-foreground">PRD가 여기에 표시됩니다.</p>
          </div>
        );
      }

      return (
        <div className="relative rounded-lg border border-border bg-card">
          {/* Header */}
          <div className="flex items-center justify-between border-b border-border px-4 py-2">
            <div className="flex items-center gap-2">
              <span className="text-sm font-medium">PRD 미리보기</span>
              {isStreaming && (
                <span className="flex items-center gap-1 text-xs text-primary">
                  <span className="h-2 w-2 animate-pulse rounded-full bg-primary" />
                  생성 중...
                </span>
              )}
            </div>
            <div className="flex gap-2">
              <Button variant="ghost" size="sm" onClick={handleCopy} disabled={isStreaming}>
                {copied ? <Check className="h-4 w-4" /> : <Copy className="h-4 w-4" />}
                <span className="ml-1">{copied ? '복사됨' : '복사'}</span>
              </Button>
            </div>
          </div>

          {/* Content */}
          <div
            ref={containerRef}
            className="h-[500px] overflow-y-auto p-6 font-mono text-sm leading-relaxed whitespace-pre-wrap"
          >
            {content}
            {isStreaming && <span className="animate-pulse">▌</span>}
          </div>
        </div>
      );
    }
    ```

    2. src/features/prd-generation/ui/index.ts (barrel export):
    ```typescript
    export { PRDForm } from './prd-form';
    export { PRDViewer } from './prd-viewer';
    export { TemplateSelector } from './template-selector';
    ```

    3. src/features/prd-generation/index.ts 업데이트:
    ```typescript
    // ... existing exports
    export { PRDForm, PRDViewer, TemplateSelector } from './ui';
    ```

    주의:
    - 스트리밍 중 자동 스크롤
    - 커서 애니메이션 (▌)
    - 복사 버튼 (클립보드 API)
  </action>
  <verify>TypeScript 컴파일 성공</verify>
  <done>PRDViewer 컴포넌트 및 barrel export 완성</done>
</task>

<task type="auto">
  <name>Task 3: /generate 페이지 구현</name>
  <files>src/app/(protected)/generate/page.tsx</files>
  <action>
    src/app/(protected)/generate/page.tsx 생성:
    ```typescript
    'use client';

    import { useState, useCallback } from 'react';
    import { PRDForm, PRDViewer } from '@/src/features/prd-generation';
    import type { PRDTemplate, PRDVersion } from '@/src/entities';
    import { useUser } from '@/src/features/auth';

    export default function GeneratePage() {
      const { profile, isLoading: isUserLoading } = useUser();
      const [content, setContent] = useState('');
      const [isGenerating, setIsGenerating] = useState(false);
      const [error, setError] = useState<string | null>(null);

      const handleGenerate = useCallback(async (data: {
        idea: string;
        template: PRDTemplate;
        version: PRDVersion;
      }) => {
        setIsGenerating(true);
        setContent('');
        setError(null);

        try {
          const response = await fetch('/api/generate-prd', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'PRD 생성에 실패했습니다.');
          }

          // Handle streaming response
          const reader = response.body?.getReader();
          const decoder = new TextDecoder();

          if (!reader) {
            throw new Error('스트리밍을 시작할 수 없습니다.');
          }

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value, { stream: true });
            setContent((prev) => prev + chunk);
          }
        } catch (err) {
          setError(err instanceof Error ? err.message : 'PRD 생성 중 오류가 발생했습니다.');
        } finally {
          setIsGenerating(false);
        }
      }, []);

      if (isUserLoading) {
        return (
          <div className="flex min-h-[50vh] items-center justify-center">
            <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
          </div>
        );
      }

      return (
        <div className="container mx-auto max-w-6xl px-4 py-8">
          <div className="mb-8">
            <h1 className="text-3xl font-bold">PRD 생성</h1>
            <p className="mt-2 text-muted-foreground">
              아이디어를 입력하면 AI가 PRD를 자동으로 생성합니다.
            </p>
          </div>

          {error && (
            <div className="mb-6 rounded-lg bg-destructive/10 p-4 text-destructive">
              {error}
            </div>
          )}

          <div className="grid gap-8 lg:grid-cols-2">
            {/* Left: Form */}
            <div>
              <PRDForm
                onSubmit={handleGenerate}
                isLoading={isGenerating}
                userCredits={profile?.credits ?? 0}
              />
            </div>

            {/* Right: Viewer */}
            <div>
              <PRDViewer content={content} isStreaming={isGenerating} />
            </div>
          </div>
        </div>
      );
    }
    ```

    주의:
    - Protected route (인증 필요)
    - useUser hook으로 크레딧 조회
    - 스트리밍 응답 처리 (ReadableStream)
    - 에러 표시
  </action>
  <verify>npm run build 성공, /generate 페이지 존재</verify>
  <done>/generate 페이지 구현 완료</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PRD 생성 전체 UI (폼 + 뷰어 + /generate 페이지)</what-built>
  <how-to-verify>
    1. npm run dev 실행
    2. 로그인 후 /generate 페이지 접속
    3. 확인 사항:
       - 템플릿 5개 선택 가능 (SaaS, Mobile, Marketplace, Extension, AI-Wrapper)
       - 버전 선택 가능 (기본 1크레딧, 상세 2크레딧)
       - 아이디어 입력 (10자 미만 시 경고)
       - 크레딧 부족 시 경고 표시
    4. PRD 생성 버튼 클릭
    5. 스트리밍 확인:
       - PRD 뷰어에 텍스트가 점진적으로 표시
       - 생성 중 커서(▌) 애니메이션
       - 자동 스크롤
    6. 생성 완료 후:
       - 복사 버튼 작동 (클립보드에 마크다운 복사)
    7. 반응형 레이아웃 확인 (모바일/데스크톱)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TemplateSelector 컴포넌트 작동
- [ ] PRDForm 입력 검증 작동
- [ ] PRDViewer 스트리밍 표시
- [ ] /generate 페이지 접근 가능
- [ ] 복사 기능 작동
- [ ] 반응형 레이아웃
- [ ] npm run build 성공
</verification>

<success_criteria>
- PRD 생성 UI 전체 구현
- 스트리밍 응답 실시간 표시
- 템플릿/버전 선택 UI
- 크레딧 표시 및 검증
- 복사 기능
</success_criteria>

<output>
After completion, create `.planning/phases/05-prd-generation/05-04-SUMMARY.md`
</output>
